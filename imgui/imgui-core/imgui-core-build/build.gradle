plugins {
    id 'java'
}

project.ext.mainClassName = "com.github.xpenatan.imgui.core.generate.BuildCore"

dependencies {
    implementation project(":imgui:imgui-core:imgui-core-base")
    implementation "com.github.xpenatan.jParser:jParser-core:$project.jParserVersion"
    implementation "com.github.xpenatan.jParser:jParser-cpp:$project.jParserVersion"
    implementation "com.github.xpenatan.jParser:jParser-teavm:$project.jParserVersion"

    implementation "com.badlogicgames.gdx:gdx-jnigen:$project.jniGenVersion"
    implementation "com.badlogicgames.gdx:gdx-jnigen-loader:$project.jniGenVersion"
}

task buildNative(dependsOn: classes, type: JavaExec) {
    setDescription("Generate native project")
    mainClass.set(project.mainClassName)
    setClasspath(sourceSets.main.runtimeClasspath)
}

task buildCpp(dependsOn: ":imgui:imgui-cpp:imgui-cpp:generateNatives") {
}

task generateNatives() {
    setDescription("Generate native project")
    dependsOn buildCpp, buildNative
}

buildNative.shouldRunAfter buildCpp